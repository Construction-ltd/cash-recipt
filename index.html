<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCMS Premium Receipt</title>
    <style>
        :root { --primary: #e67e22; --dark: #2c3e50; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: #dfe6e9; padding: 20px; margin: 0; }
        
        .control-panel { max-width: 850px; margin: 0 auto 20px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 5px solid var(--primary); }
        .grid-input { display: grid; grid-template-columns: 2fr 1fr auto; gap: 15px; align-items: end; }
        @media (max-width: 650px) { .grid-input { grid-template-columns: 1fr; } }
        label { font-size: 12px; font-weight: bold; color: var(--dark); text-transform: uppercase; margin-bottom: 5px; display: block; }
        select, input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px; outline: none; box-sizing: border-box; }
        .btn-generate { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; height: 45px; }

        #receipt-wrap { display: none; max-width: 850px; margin: 0 auto; background: white; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .receipt-body { padding: 40px; border: 15px solid var(--light); position: relative; background: #fff; min-height: 500px; }
        
        .header { display: flex; justify-content: space-between; border-bottom: 3px solid var(--primary); padding-bottom: 20px; margin-bottom: 30px; }
        .brand h1 { margin: 0; color: var(--dark); font-size: 26px; letter-spacing: 1px; }
        .brand h1 span { color: var(--primary); }
        .contact-info { text-align: right; font-size: 12px; color: #666; line-height: 1.6; }

        .receipt-banner { text-align: center; margin-bottom: 40px; }
        .receipt-banner h2 { display: inline-block; background: var(--dark); color: white; padding: 8px 40px; border-radius: 5px; font-size: 18px; letter-spacing: 3px; margin: 0; }

        .info-row { display: flex; margin-bottom: 25px; align-items: baseline; gap: 10px; }
        .info-label { font-weight: bold; color: var(--dark); white-space: nowrap; font-size: 14px; }
        .info-value { border-bottom: 1px dashed #ccc; flex-grow: 1; padding: 0 10px; color: #333; font-size: 16px; min-height: 20px; }

        /* Password and Special Advise Section */
        .advise-box { background: #fff9e6; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 5px solid #f1c40f; }
        .advise-box p { margin: 0; font-size: 13px; color: #7f8c8d; line-height: 1.5; }
        .advise-box b { color: var(--dark); }

        .amount-row { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; background: var(--light); padding: 20px; border-radius: 10px; }
        .amt-box { font-size: 26px; font-weight: 800; color: var(--dark); border-left: 5px solid var(--primary); padding-left: 15px; }

        .signature-area { margin-top: 60px; display: flex; justify-content: space-between; align-items: flex-end; }
        .sig-box { width: 180px; text-align: center; border-top: 2px solid var(--dark); padding-top: 10px; font-weight: bold; color: var(--dark); font-size: 13px; }
        
        .qr-section { text-align: center; width: 180px; }
        .qr-box { padding: 5px; border: 1px solid #eee; border-radius: 5px; background: #fff; display: inline-block; }
        .qr-box img { width: 100px; height: 100px; display: block; margin: 0 auto; }
        .qr-instruction { font-size: 10px; color: #e67e22; font-weight: bold; margin-top: 5px; text-transform: uppercase; }

        .print-fab { width: 100%; padding: 15px; background: var(--dark); color: white; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }

        @media print {
            body { background: white; padding: 0; }
            .control-panel, .print-fab { display: none !important; }
            #receipt-wrap { display: block !important; box-shadow: none; width: 100%; margin: 0; }
            .receipt-body { border: none; padding: 10px; }
        }
    </style>
</head>
<body>

<div class="control-panel">
    <div class="grid-input">
        <div>
            <label>Select Client / Payer</label>
            <select id="payerSelect"><option value="">Loading Data...</option></select>
        </div>
        <div>
            <label>Transaction Date</label>
            <input type="date" id="dateSearch">
        </div>
        <button class="btn-generate" onclick="drawReceipt()">GENERATE RECEIPT</button>
    </div>
</div>

<div id="receipt-wrap">
    <div class="receipt-body">
        <div class="header">
            <div class="brand">
                <h1>SOHANUR <span>CONSTRUCTION</span></h1>
                <p style="font-size: 11px; font-weight: bold; color: var(--primary); margin: 0;">& MANPOWER SOLUTION</p>
            </div>
            <div class="contact-info">
                üìç Naogaon Sadar, Naogaon<br>
                üìû +8801805-090910, 090950<br>
                üìß sohanurconstructionltd@gmail.com
            </div>
        </div>

        <div class="receipt-banner"><h2>MONEY RECEIPT</h2></div>

        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
            <div style="font-weight: bold;">Receipt No: <span id="r-no" style="color: var(--primary);"></span></div>
            <div style="font-weight: bold;">Date: <span id="r-date"></span></div>
        </div>

        <div class="info-row">
            <span class="info-label">Received with thanks from :</span>
            <span class="info-value" id="r-name" style="font-weight: bold; font-size: 17px; text-transform: uppercase;"></span>
        </div>

        <div class="info-row">
            <span class="info-label">The Sum of (In Words) :</span>
            <span class="info-value" id="r-words" style="font-style: italic;"></span>
        </div>

        <div class="info-row">
            <span class="info-label">Payment Purpose / Mode :</span>
            <span class="info-value" id="r-mode"></span>
        </div>

        <div class="advise-box">
            <p><b>Client Instruction:</b> Use the password <b><span id="r-pass-label" style="color:#d35400; font-size:16px;"></span></b> to log in to your dashboard. Scan the QR code below for instant access to your payment history and details.</p>
        </div>

        <div class="amount-row">
            <div class="amt-box">Tk. <span id="r-amt"></span> /-</div>
            <div style="font-style: italic; color: #7f8c8d; font-size: 13px;">Verified Digital Record</div>
        </div>

        <div class="signature-area">
            <div class="sig-box">Payer Signature</div>
            
            <div class="qr-section">
                <div class="qr-box">
                    <img id="qr-code-img" src="" alt="QR Code">
                </div>
                <div class="qr-instruction">Scan to Login</div>
            </div>

            <div class="sig-box" style="border-top-color: var(--primary);">Authorized Signature</div>
        </div>
    </div>
    <button class="print-fab" onclick="window.print()">DOWNLOAD AS PDF / PRINT</button>
</div>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTAwqKg4QjdIUWQ31Nxl7wnkIRpx_H80Ddd7lsW4s0bgVowNL2xFSPhOYcB-RwwrO7b0x5lF61Yv03D/pub?gid=239856359&single=true&output=csv";
    const USER_DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTAwqKg4QjdIUWQ31Nxl7wnkIRpx_H80Ddd7lsW4s0bgVowNL2xFSPhOYcB-RwwrO7b0x5lF61Yv03D/pub?gid=1258553023&single=true&output=csv";

    let dataStore = [];
    let userStore = [];

    async function loadSheet() {
        try {
            const [res, uRes] = await Promise.all([fetch(CSV_URL), fetch(USER_DATA_URL)]);
            dataStore = (await res.text()).split('\n').map(r => r.split(','));
            userStore = (await uRes.text()).split('\n').map(r => r.split(','));

            const select = document.getElementById('payerSelect');
            select.innerHTML = '<option value="">Select Client Name</option>';
            let names = [...new Set(dataStore.slice(1).map(r => r[3]?.replace(/"/g, '').trim()).filter(n => n))];
            names.sort().forEach(n => select.add(new Option(n, n)));
        } catch (e) { console.log("Data Load Error"); }
    }

    function drawReceipt() {
        const name = document.getElementById('payerSelect').value;
        const dateInput = document.getElementById('dateSearch').value; 
        if(!name && !dateInput) return alert("Please select a Name or Date");

        let formattedDate = "";
        if(dateInput) {
            const d = new Date(dateInput);
            formattedDate = `${d.getDate().toString().padStart(2, '0')}/${(d.getMonth() + 1).toString().padStart(2, '0')}/${d.getFullYear()}`;
        }

        const row = dataStore.slice(1).reverse().find(r => {
            const rowName = r[3]?.replace(/"/g, '').trim();
            const rowDate = r[2]?.replace(/"/g, '').trim();
            return (name && dateInput) ? (rowName === name && rowDate === formattedDate) : (name ? rowName === name : rowDate === formattedDate);
        });

        if(row) {
            document.getElementById('receipt-wrap').style.display = 'block';
            const receiptID = row[1]?.replace(/"/g, '') || "N/A";
            const payerName = row[3]?.replace(/"/g, '').trim();
            const amountNum = parseFloat(row[4]?.replace(/[^0-9.]/g, '') || "0");
            
            const userRow = userStore.find(u => u[0]?.replace(/"/g, '').trim() === payerName);
            const userPass = userRow ? userRow[1]?.replace(/"/g, '').trim() : "N/A";

            document.getElementById('r-no').innerText = receiptID;
            document.getElementById('r-date').innerText = row[2]?.replace(/"/g, '') || "";
            document.getElementById('r-name').innerText = payerName;
            document.getElementById('r-mode').innerText = "Transaction ID: " + receiptID;
            document.getElementById('r-amt').innerText = amountNum.toLocaleString('en-IN');
            document.getElementById('r-words').innerText = toWords(amountNum) + " Taka Only";
            document.getElementById('r-pass-label').innerText = userPass;
            
            // QR Code Logic: ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
            const qrLink = `https://construction-ltd.github.io/client-login/`;
            document.getElementById('qr-code-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(qrLink)}`;

            setTimeout(() => { window.scrollTo({top: 400, behavior: 'smooth'}); }, 200);
        } else {
            alert("No record found!");
        }
    }

    function toWords(num) {
        const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
        const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        function helper(n) {
            if (n < 20) return a[n];
            if (n < 100) return b[Math.floor(n / 10)] + ' ' + a[n % 10];
            if (n < 1000) return helper(Math.floor(n / 100)) + 'Hundred ' + helper(n % 100);
            if (n < 100000) return helper(Math.floor(n / 1000)) + 'Thousand ' + helper(n % 1000);
            if (n < 10000000) return helper(Math.floor(n / 100000)) + 'Lakh ' + helper(n % 100000);
            return helper(Math.floor(n / 10000000)) + 'Crore ' + helper(n % 10000000);
        }
        return helper(Math.round(num));
    }
    window.onload = loadSheet;
</script>
</body>
</html>
